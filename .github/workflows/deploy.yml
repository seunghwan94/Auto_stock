name: Auto Deploy to EC2

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Deploy to EC2 and restart start.py
      uses: appleboy/ssh-action@v0.1.10
      with:
        host: ${{ secrets.EC2_HOST }}
        username: ubuntu
        key: ${{ secrets.EC2_PRIVATE_KEY }}
        script: |
          echo "ğŸš€ ë°°í¬ ì‹œì‘"

          # í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
          cd ~/StockAuto

          # ìµœì‹  ì½”ë“œ pull
          git pull origin master

          # ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
          chmod +x start.sh

          # âœ… í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
          export ENV=production
          export LIVE_MODE=False
          export UPBIT_ACCESS_KEY=${{ secrets.UPBIT_ACCESS_KEY }}
          export UPBIT_SECRET_KEY=${{ secrets.UPBIT_SECRET_KEY }}
          export DISCORD_WEBHOOK_URL=${{ secrets.DISCORD_WEBHOOK_URL }}

          # âœ… ì‹¤í–‰ (í™˜ê²½ë³€ìˆ˜ ìœ ì§€í•˜ë©° ì‹¤í–‰ë˜ë„ë¡ start.sh ì‘ì„±ë¼ ìˆì–´ì•¼ í•¨)
          ./start.sh

          echo "âœ… ë°°í¬ ë° start.py ì‹¤í–‰ ì™„ë£Œ"
